<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ØªÙ… Ø§Ù„Ø¯ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{font-family:system-ui,-apple-system;max-width:720px;margin:24px auto;padding:24px;background:#f7f7f7}
    .card{background:#fff;padding:20px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.06)}
    h1{color:#22c55e;margin:0 0 10px}
    p{margin:6px 0;color:#333}
    code{display:block;background:#fafafa;border:1px solid #eee;border-radius:8px;padding:10px;direction:ltr}
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
    a.btn,button.btn{appearance:none;border:0;border-radius:10px;padding:12px 16px;text-decoration:none;display:inline-block;cursor:pointer}
    .primary{background:#2563eb;color:#fff}
    .muted{background:#eee;color:#111}
    .ok{color:#16a34a}
    .warn{color:#b45309}
    small{color:#666}
  </style>
</head>
<body>
  <div class="card">
    <h1>âœ… ØªÙ… Ø§Ù„Ø¯ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­</h1>
    <p>Ø´ÙƒØ±Ù‹Ø§ Ù„Ùƒ! Ø§Ø³ØªÙ„Ù…Ù†Ø§ Ø¨ÙŠØ§Ù†Ø§ØªÙƒØŒ ÙˆÙ†Ø³ÙˆÙ‘ÙŠ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ù„Ùƒ Ø§Ù„Ø¢Ù†.</p>

    <p><b>Ø§Ù„Ø¨Ø±ÙŠØ¯:</b> <span id="email">â€”</span></p>
    <p><b>UDID:</b></p>
    <code id="udid">â€”</code>

    <p id="status" class="warn">Ù†Ø­Ø§ÙˆÙ„ Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ù„Ø³ÙŠØ±ÙØ±â€¦</p>

    <div class="row">
      <!-- Ø²Ø± ØªØ­Ù…ÙŠÙ„ ÙÙˆØ±ÙŠ ÙƒØ­Ù„ Ø§Ø­ØªÙŠØ§Ø·ÙŠ -->
      <a id="downloadCert" class="btn primary" href="UDID.mobileconfig" download>ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø´Ù‡Ø§Ø¯Ø© UDID (Ø¨Ø¯ÙŠÙ„ Ù…Ø¤Ù‚Øª)</a>
      <!-- Ø²Ø± ÙˆØ§ØªØ³Ø§Ø¨ ÙŠØ±Ø³Ù„ Ù†ÙØ³ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ùƒ -->
      <a id="whatsapp" class="btn muted" target="_blank">ğŸ’¬ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</a>
    </div>

    <p><small>Ù„Ùˆ Ù…Ø§ ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ØŒ ØªÙ‚Ø¯Ø± ØªØ­Ù…Ù„ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø¢Ù† ÙˆØªØ±Ø³Ù„ Ù„Ù†Ø§ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ØŒ ÙˆØ¨Ù†ØµØ¯Ø±Ù‡Ø§ Ù„Ùƒ ÙŠØ¯ÙˆÙŠÙ‹Ø§.</small></p>
  </div>

  <script>
    // Ø¶Ø¹ Ø±Ø§Ø¨Ø· Ø§Ù„Ø³ÙŠØ±ÙØ± Ù„Ù…Ø§ ØªÙØ¹Ù‘Ù„Ù‡ Ø¹Ù„Ù‰ Render (Ù…Ø«Ø§Ù„: https://gbox-cert-site.onrender.com)
    const BACKEND_URL = ""; // â† Ø¥Ø°Ø§ ÙØ¶ÙŠØŒ Ø¨Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¨Ø¯Ø§Ø¦Ù„ (ØªØ­Ù…ÙŠÙ„ + ÙˆØ§ØªØ³Ø§Ø¨)

    const qs = new URLSearchParams(location.search);
    const email = qs.get('email') || '';
    const udid  = qs.get('udid')  || '';

    // Ø£Ø¹Ø±Ø¶ Ø§Ù„Ù‚ÙŠÙ…
    document.getElementById('email').textContent = email || 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
    document.getElementById('udid').textContent  = udid  || 'ØºÙŠØ± Ù…ØªÙˆÙØ±';

    // Ø¬Ù‡Ù‘Ø² Ø²Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ø¨Ø±Ø³Ø§Ù„Ø© Ø¬Ø§Ù‡Ø²Ø©
    (function(){
      const msg = `Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ Ù‡Ø°Ù‡ Ø¨ÙŠØ§Ù†Ø§Øª Ø·Ù„Ø¨ÙŠ:\nEmail: ${email || '-'}\nUDID: ${udid || '-'}`;
      const phone = '9665XXXXXXXX'; // â† Ø¶Ø¹ Ø±Ù‚Ù…Ùƒ Ø¨ØµÙŠØºØ© Ø¯ÙˆÙ„ÙŠØ©
      const wa = document.getElementById('whatsapp');
      wa.href = `https://wa.me/${phone}?text=${encodeURIComponent(msg)}`;
    })();

    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø³ÙŠØ±ÙØ± (Ø£ÙØ¶Ù„ ØªØ¬Ø±Ø¨Ø©)
    async function sendToBackend(){
      const st = document.getElementById('status');
      if(!BACKEND_URL){
        st.textContent = 'Ù…Ø§ Ø¹Ù†Ø¯Ù†Ø§ Ø³ÙŠØ±ÙØ± Ø§Ù„Ø¢Ù† â€” Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø£Ø¹Ù„Ø§Ù‡ Ù…Ø¤Ù‚ØªÙ‹Ø§.';
        st.className = 'warn';
        return;
      }
      try {
        st.textContent = 'ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ø³ÙŠØ±ÙØ±â€¦';
        // Ù†Ù‚Ø·Ø© Ø§Ø³ØªÙ„Ø§Ù… Ø¨Ø³ÙŠØ·Ø© ØªÙ‚ØªØ±Ø­: /api/queue  (Ø¨Ù†ÙØ¹Ù‘Ù„Ù‡Ø§ Ù„Ùƒ ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±)
        const res = await fetch(BACKEND_URL + '/api/queue', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ email, udid })
        });
        if(!res.ok) throw new Error('bad status ' + res.status);
        const data = await res.json().catch(()=>({}));
        st.textContent = 'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­. Ø¨Ù†Ø±Ø³Ù„ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø¹Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ Ù‚Ø±ÙŠØ¨Ù‹Ø§ âœ‰ï¸';
        st.className = 'ok';
        // Ù„Ùˆ Ø±Ø¬Ø¹ orderId Ù†Ù‚Ø¯Ø± Ù†Ø¹Ù…Ù„ ØªØªØ¨Ù‘Ø¹:
        if(data.orderId){
          // Ù…Ø«Ø§Ù„: Ø¹Ø±Ø¶ Ø±Ø§Ø¨Ø· ØªØªØ¨Ù‘Ø¹ (ÙÙŠ Ø­Ø§Ù„ ÙØ¹Ù‘Ù„Ù†Ø§Ù‡ ÙÙŠ Ø§Ù„Ø¨Ø§ÙƒÙ†Ø¯)
          const a = document.createElement('a');
          a.href = BACKEND_URL + '/orders/' + data.orderId;
          a.target = '_blank';
          a.textContent = 'Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨';
          a.className = 'btn muted';
          document.querySelector('.row').appendChild(a);
        }
      } catch(e){
        st.textContent = 'ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ± â€” Ø§Ø³ØªØ®Ø¯Ù… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø£Ùˆ ÙˆØ§ØªØ³Ø§Ø¨.';
        st.className = 'warn';
      }
    }
    sendToBackend();
  </script>
</body>
</html>
